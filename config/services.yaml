imports:
    - { resource: 'services_test.yaml', ignore_errors: true }

parameters:

services:
    _defaults:
        autowire: true
        autoconfigure: true

    App\:
        resource: '../src/'
        exclude:
            - '../src/Kernel.php'
            - '../src/*/Domain/Entity/'
            - '../src/*/Domain/ValueObject/'
            - '../src/*/Domain/Event/'
            - '../src/*/Domain/Exception/'

    # Register all command and query handlers as message handlers
    App\BankAccount\Application\Command\:
        resource: '../src/BankAccount/Application/Command/*Handler.php'
        tags: [messenger.message_handler]

    App\BankAccount\Application\Query\:
        resource: '../src/BankAccount/Application/Query/*Handler.php'
        tags: [messenger.message_handler]

    App\Transaction\Application\Command\:
        resource: '../src/Transaction/Application/Command/*Handler.php'
        tags: [messenger.message_handler]

    App\UserManagement\Application\Command\:
        resource: '../src/UserManagement/Application/Command/*Handler.php'
        tags: [messenger.message_handler]

    App\UserManagement\Application\Query\:
        resource: '../src/UserManagement/Application/Query/*Handler.php'
        tags: [messenger.message_handler]

    # Event Bus
    App\Shared\Domain\Event\EventBus: '@App\Shared\Infrastructure\Event\SymfonyMessengerEventBus'

    App\Shared\Infrastructure\Event\SymfonyMessengerEventBus:
        arguments:
            $eventBus: '@event.bus'

    # Repository interfaces
    App\UserManagement\Domain\Persistence\Repository\UserRepositoryInterface:
        alias: App\UserManagement\Infrastructure\Persistence\Repository\DbalUserRepository

    App\BankAccount\Domain\Persistence\Repository\BankAccountRepositoryInterface:
        alias: App\BankAccount\Infrastructure\Persistence\Repository\DbalBankAccountRepository

    App\Transaction\Domain\Persistence\Repository\TransactionRepositoryInterface:
        alias: App\Transaction\Infrastructure\Persistence\Repository\DbalTransactionRepository

    # Providers
    App\Transaction\Domain\Provider\ExchangeRateProviderInterface:
        alias: App\Transaction\Infrastructure\Provider\StaticExchangeRateProvider
